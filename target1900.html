　<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ターゲット1900クイズ with Firebase</title>
<style>
:root {
  --primary-bg: #1E3A8A;
  --card-bg: #FFFFFF;
  --button-bg: #3B82F6;
  --button-hover: #2563EB;
  --correct-color: #10B981;
  --incorrect-color: #EF4444;
  --text-light: #FFFFFF;
}
body {
  font-family: 'Segoe UI', sans-serif;
  background: var(--primary-bg);
  color: var(--text-light);
  text-align: center;
  padding: 50px 20px;
  position: relative;
}
h1 { font-size: 2.5em; margin-bottom: 30px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);}
input[type="text"], input[type="email"], input[type="password"], input[type="number"] {
  width: 200px; padding: 10px; font-size: 1.2em; margin: 5px; border-radius: 8px; border: none;
}
button {
  padding: 15px 25px; font-size: 1.3em; border: none; border-radius: 10px; margin: 10px; cursor: pointer;
  background: var(--button-bg); color: var(--text-light); transition: all 0.3s;
}
button:hover { background: var(--button-hover); transform: scale(1.05); }

section { display:none; }
#overlay {
  position: fixed; top:0; left:0; width:100%; height:100%;
  display:flex; align-items:center; justify-content:center;
  font-size:20em; font-weight:900; -webkit-text-stroke:8px white;
  opacity:0; pointer-events:none; transition: all 0.3s; z-index:1000; transform: scale(0.5);
}
#overlay.correct { color: var(--correct-color); }
#overlay.incorrect { color: var(--incorrect-color); }
#overlay.show { opacity: 1; pointer-events: auto; animation: pop 0.5s forwards;}
@keyframes pop {0% { transform: scale(0.5); opacity:0;} 50% { transform: scale(1.3); opacity:1;} 100% { transform: scale(1); opacity:1;} }
#quizBox { background: var(--card-bg); color: #1F2937; border-radius: 15px; padding: 30px; max-width:600px; margin:auto; position: relative; }
#status { display:flex; justify-content:space-between; margin-bottom:20px; color:#1F2937; font-weight:bold; }
#status div { font-size:1em; }
.choice-btn { font-size:1.5em; padding:20px; border-radius:15px; border:none; background:var(--button-bg); color:var(--text-light); cursor:pointer; transition:all 0.2s; }
.choice-btn:hover { background: var(--button-hover); transform: scale(1.05);}
#backBtn { position:absolute; top:20px; left:20px; font-size:2em; padding:5px 12px; border-radius:50%; background:rgba(59,130,246,0.8); color:white; border:none; cursor:pointer; z-index:10; transition: all 0.2s; }
#backBtn:hover { background: rgba(37,99,235,0.9); transform: scale(1.2); }
.result h2 { font-size:2.5em; margin-bottom:20px; }
.result p { font-size:1.5em; margin:10px 0; }
</style>
</head>
<body>
<h1>ターゲット1900クイズ</h1>

<!-- サインアップ/ログイン -->
<section id="authSection">
  <h2>アカウント作成 / ログイン</h2>
  <input type="email" id="email" placeholder="メールアドレス"><br>
  <input type="password" id="password" placeholder="パスワード"><br>
  <button onclick="signUp()">アカウント作成</button>
  <button onclick="signIn()">ログイン</button>
</section>

<!-- 範囲選択 -->
<section id="rangeSection">
  <p>範囲を入力してください（例: 1〜500）</p>
  <input type="number" id="startNum" placeholder="開始" min="1" max="1900">
  <input type="number" id="endNum" placeholder="終了" min="1" max="1900">
  <br>
  <button onclick="startQuiz()">開始</button>
</section>

<!-- クイズ -->
<section id="quizSection">
  <button id="backBtn" onclick="goBack()">&lt;</button>
  <div id="status">
    <div id="remaining">残り:0</div>
    <div id="timer">経過:0.0s</div>
    <div id="countdown"></div>
  </div>
  <p id="question"></p>
  <div id="choices"></div>
</section>

<div id="overlay"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAHI9pAKyF_WQDkKq5eK00rtq9YaRCt4RY",
  authDomain: "target1900-7fdbf.firebaseapp.com",
  projectId: "target1900-7fdbf",
  storageBucket: "target1900-7fdbf.firebasestorage.app",
  messagingSenderId: "1012046894826",
  appId: "1:1012046894826:web:08306a0eefd6f1cbf66993",
  measurementId: "G-YJCFD36EPX"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let words = [];
let filteredWords = [];
let quizQueue = [];
let currentQuestion = null;
let elapsedTime = 0;
let timerInterval = null;
let countdownInterval = null;
let correctCount = 0;

// 仮の words.json データ
words = Array.from({length:1900}, (_,i)=>({word:"word"+(i+1),meaning:"意味"+(i+1)}));

function signUp() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  if(!email||!password){alert("入力してください");return;}
  auth.createUserWithEmailAndPassword(email,password)
    .then(()=>{alert("アカウント作成完了"); showRangeSection();})
    .catch(e=>alert(e.message));
}

function signIn() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  if(!email||!password){alert("入力してください");return;}
  auth.signInWithEmailAndPassword(email,password)
    .then(()=>{alert("ログイン成功"); showRangeSection();})
    .catch(e=>alert(e.message));
}

function showRangeSection() {
  document.getElementById('authSection').style.display='none';
  document.getElementById('rangeSection').style.display='block';
}

function startQuiz() {
  const start=parseInt(document.getElementById('startNum').value);
  const end=parseInt(document.getElementById('endNum').value);
  if(isNaN(start)||isNaN(end)||start<1||end>words.length||start>end){alert("正しい範囲を入力");return;}
  filteredWords = words.slice(start-1,end);
  quizQueue = shuffleArray([...filteredWords]);
  correctCount = 0;
  elapsedTime = 0;

  document.getElementById('rangeSection').style.display='none';
  document.getElementById('quizSection').style.display='block';
  document.getElementById('quizSection').classList.remove('result');

  document.getElementById('remaining').textContent="残り:"+quizQueue.length;
  document.getElementById('timer').textContent="経過:0.0s";
  document.getElementById('countdown').textContent="3";

  let count=3;
  countdownInterval=setInterval(()=>{
    count--;
    if(count>0){document.getElementById('countdown').textContent=count;}
    else{clearInterval(countdownInterval);document.getElementById('countdown').textContent='';startTimer();showQuestion();}
  },1000);
}

function startTimer(){if(timerInterval)clearInterval(timerInterval); timerInterval=setInterval(()=>{elapsedTime+=0.1; document.getElementById('timer').textContent="経過:"+elapsedTime.toFixed(1)+"s";},100);}
function stopTimer(){if(timerInterval)clearInterval(timerInterval);}
function shuffleArray(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];} return array;}

function showQuestion(){
  if(quizQueue.length===0){showResult(); return;}
  const choicesDiv=document.getElementById('choices'); choicesDiv.innerHTML='';
  currentQuestion=quizQueue.shift();
  document.getElementById('remaining').textContent="残り:"+quizQueue.length;

  const q=document.getElementById('question'); q.textContent="単語:"+currentQuestion.word;
  const choices=[currentQuestion.meaning];
  while(choices.length<4){const r=filteredWords[Math.floor(Math.random()*filteredWords.length)].meaning; if(!choices.includes(r))choices.push(r);}
  choices.sort(()=>Math.random()-0.5);
  choices.forEach(c=>{const btn=document.createElement('button'); btn.textContent=c; btn.className='choice-btn'; btn.onclick=()=>handleAnswer(c); choicesDiv.appendChild(btn);});
}

function handleAnswer(choice){
  stopTimer();
  const overlay=document.getElementById('overlay'); const isCorrect=choice===currentQuestion.meaning;
  overlay.textContent=isCorrect?"○":"×";
  overlay.className=isCorrect?"correct show":"incorrect show";
  if(isCorrect) correctCount++;
  document.querySelectorAll('.choice-btn').forEach(b=>b.disabled=true);
  setTimeout(()=>{overlay.className=''; startTimer(); showQuestion();},700);
}

function showResult(){
  stopTimer();
  const totalQuestions=filteredWords.length;
  const incorrectCount=totalQuestions-correctCount;
  const penalty=incorrectCount*5;
  const totalTime=elapsedTime+penalty;
  const correctRate=((correctCount/totalQuestions)*100).toFixed(1);
  const quizSection=document.getElementById('quizSection');
  quizSection.classList.add('result');
  quizSection.innerHTML=`
    <h2>結果</h2>
    <p>正答率: ${correctRate}% (${correctCount}/${totalQuestions})</p>
    <p>経過時間: ${elapsedTime.toFixed(1)}秒</p>
    <p>ペナルティ: ${penalty}秒 (不正解 ${incorrectCount}問×5秒)</p>
    <p>合計時間: ${totalTime.toFixed(1)}秒</p>
    <button onclick="restartQuiz()">もう一度挑戦</button>
  `;

  // Firestore に保存
  const user = auth.currentUser;
  if(user){
    db.collection('results').add({
      uid: user.uid,
      email: user.email,
      score: correctRate,
      elapsedTime: elapsedTime.toFixed(1),
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  }
}

function restartQuiz(){document.getElementById('rangeSection').style.display='block'; document.getElementById('quizSection').style.display='none';}
function goBack(){stopTimer(); if(countdownInterval)clearInterval(countdownInterval); document.getElementById('quizSection').style.display='none'; document.getElementById('rangeSection').style.display='block';}

</script>
</body>
</html>